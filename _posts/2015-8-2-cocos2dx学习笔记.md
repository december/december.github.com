---
layout: post
category: 技术
tags: cocos2dx 游戏开发 引擎
description: 学习cocos2dx引擎的结构与开发
---

### 关于cocos2dx

  * cocos2d-x是一个广受欢迎的开源游戏引擎，主要用于开发2D风格化手游，影响范围很大，社区活跃
  * cocos2d-x核心使用C++基于OpenGL开发，保证了良好的跨平台性，并具有Javascript绑定功能以便于编程
  * cocos2d-x是由触控科技支持开发的，个人觉得这也算是国内游戏行业值得骄傲的突破

### 基本思想

  * 整个游戏（或者说工程）有一个director类，负责对各种游戏元素的控制、各种游戏数据的保存与调用以及一些全局数据的获取和管理，采用单件设计模式。
  * 游戏中有各种丰富的场景（scene），屏幕上展现出的一幅画面就是一个scene，director可以管理和控制scene的产生、消亡和切换，把scene当做是一个基本元素，可以有以下操作：

        runWithScene(Scene *scene)    //启动游戏，并将scene设为当前场景
        pushScene(Scene *scene)       //将当前运行中的场景暂停并压入到代码执行场景栈中，再将传入的scene设置为当前运行场景
        replaceScene(Scene *scene)    //直接使用传入的scene替换当前场景来切换画面，释放当前场景
        popScene()                    //释放当前场景，再从代码执行场景中弹出栈顶的场景，并将其设置为当前运行场景（如果栈为空，直接结束应用）
        end()                         //退出应用，终止并释放所有场景

  * 每个场景中可以有多个层（layer），一般将属性、运动等相似的对象作为一个层，假设用cocos2dx做一个类似dota的游戏，那么可以将所有的英雄归为一个层，将所有技能特效归为另一个层，每个层可以利用接口进行一些统一的处理。
  * 在层内可以增加精灵（sprite），精灵类是游戏引擎的核心，对每个具体的游戏元素的操作基本都是通过精灵来实现的，例如加载图片、更改纹理、更改位置、设置动画、设置事件等等，因此每个游戏元素从显示到运动再到某些事件的触发都需要借助精灵类来实现。
  * 以上提到的director、scene、layer、sprite等类都继承自一个基础类——node类，在组织结构上也可以将以上4类看成是节点，组成了从上到下的树形结构。其中director是整个结构的根节点，全局只有一个；而sprite作为最底层的叶节点，直接与具体的游戏元素（如具体的某个英雄）对应。还是以做一个类似dota的游戏为例，就得到了这样的整体逻辑：

        某个英雄的技能、运动与属性（精灵） -> 所有英雄（层） -
                                                       |-> 战斗界面（场景） -
        某个特效的纹理、动画与图片（精灵） -> 所有特效（层） -                    |
                                                                           |->游戏（导演）
                                                                           |
                                                           开始界面（场景） -

### 





